-- 41.THE HAVING CLAUSE

We basically use the having clause to filter the data after we our rows are grouped.


Select client_id,
       sum(invoice_total) as total_sales
from invoices
group by client_id;


-- If we want to select only the clients
-- which have sales greater than 500$, then
-- we will have to use having clause
-- because, we are getting the total sales only 
-- after using the group by clause and if we 
-- want to filter out data after that, we must uyse having clause. 
-- We can not use where clause in that case.

Example:-
Select client_id,
       sum(invoice_total) as total_sales
from invoices
group by client_id
having total_sales>500;



-- select the clients
-- from invoices table
-- which have invoice_total > 500 
-- and have number of invoices > 5

select client_id,
       sum(invoice_total) as invoice_total,
       count(*) as no_of_invoices
from invoices 
 group by client_id
 having invoice_total>500
        and no_of_invoices > 5;



-- Also, while using the having clause, we have to use only the columns that 
-- are present in the select clause only. whereas in the where clause we can use any column 
-- from the tables that we are using.


-- Exercise 133.png and 134.png

Select c.customer_id,
	   c.first_name,
       c.last_name,
       sum(oi.quantity*oi.unit_price) as money_spent
from customers c
join orders o
on c.customer_id = o.customer_id
join order_items oi
on oi.order_id=o.order_id
where c.state = 'VA'
group by customer_id
having money_spent > 100;

