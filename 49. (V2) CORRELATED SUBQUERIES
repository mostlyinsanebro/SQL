-- 49. Correlated Subqueries

-- 158.png and 159.png

Select * 
from employees e1
where salary > (
	  select avg(salary) 
      from employees e2
	  where e2.office_id=e1.office_id);

-- Exercise 161.png and Exercise 162.png

Select * 
from invoices i
where invoice_total > (
		Select avg(invoice_total)
		from invoices
		where client_id=i.client_id
);


-- How does the correlated subqueries work 
First of all, the execution will start and it will run line by line in a table.


Select * 
from invoices i
where invoice_total > (
		Select avg(invoice_total)
		from invoices
		where client_id=i.client_id
);

For this query, the execution will be done for each line.
Suppose, for the first line, the client_id is 2, then the execution goes to the subquery.
So, for the client_id =2 , the average of invoice_total
will be calculated for that client_id and if the current
client has more salary than the average for that client_id,
then it will be selected and the whole invoice_id and client_id and invoice_total
are printed.
